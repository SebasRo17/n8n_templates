{
  "name": "CORTES",
  "nodes": [
    {
      "parameters": {
        "query": "=SELECT\n  IPMD.ESTADO,\n  COUNT(1) AS NUM_REGISTROS,\n  IPMD.OBSERVACION\nFROM\n  DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_DET IPMD\n  INNER JOIN DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_CAB IPMC\n    ON IPMC.ID_PROCESO_MASIVO_CAB = IPMD.PROCESO_MASIVO_CAB_ID\nWHERE\n  IPMD.FE_CREACION BETWEEN TO_TIMESTAMP('{{ $json.fecha_inicio }}', 'DD/MM/YYYY HH24:MI:SS.FF')\n    AND TO_TIMESTAMP('{{ $json.fecha_fin }}', 'DD/MM/YYYY HH24:MI:SS.FF')\n  AND IPMC.TIPO_PROCESO = 'CortarCliente'\n  AND IPMC.EMPRESA_ID = 18\n  AND IPMD.ESTADO = 'Fallo'\nGROUP BY\n  IPMD.ESTADO,\n  IPMD.OBSERVACION"
      },
      "type": "n8n-nodes-oracle-database-parameterization.Oracle Database with Parameterization",
      "typeVersion": 1,
      "position": [-2272, -112],
      "id": "fe9f2dce-c697-459f-a077-1accc1d49d07",
      "name": "Oracle Database",
      "credentials": {
        "oracleCredentials": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "chatId": "",
        "text": "=*ðŸ›‘ðŸš¨ ALERTA CRÃTICA EN CORTES ðŸš¨ðŸ›‘*\n\nSe han identificado *{{ $('CANTIDAD DE FALLOS').item.json.rows[0].NUM_REGISTROS }}* procesos con fallo en el sistema\\.\n\nRequiere atenciÃ³n urgente\\.",
        "additionalFields": {
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [-256, -112],
      "id": "ef4b1faf-1bb8-43de-b4c1-3f6b3b015250",
      "name": "Send a text message1",
      "webhookId": "",
      "credentials": {
        "telegramApi": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "chatId": "",
        "text": "={{ $('JUNTAR MENSAJES').item.json.mensaje }}",
        "additionalFields": {
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [-32, -112],
      "id": "d54c6c22-81ef-4dd5-8ffb-b1d0692eb900",
      "name": "Send a text message2",
      "webhookId": "",
      "credentials": {
        "telegramApi": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "897bdfb0-7e40-422a-b224-0fb11a5b8f4f",
              "name": "fecha_inicio",
              "value": "={{ (() => {   const d = new Date();   const dd = String(d.getDate()).padStart(2, '0');   const mm = String(d.getMonth()+1).padStart(2, '0');   const yyyy = d.getFullYear();   return `${dd}/${mm}/${yyyy} 00:00:00.000000`; })() }}",
              "type": "string"
            },
            {
              "id": "f97db624-dc43-43aa-bb50-34aec49ace96",
              "name": "fecha_fin",
              "value": "={{ (() => {   const d = new Date();   const dd = String(d.getDate()).padStart(2, '0');   const mm = String(d.getMonth()+1).padStart(2, '0');   const yyyy = d.getFullYear();   return `${dd}/${mm}/${yyyy} 23:59:59.000000`; })() }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [-2496, -112],
      "id": "94adc953-e808-4453-a47f-9d607dcd3f9e",
      "name": "SETEAR FECHAS"
    },
    {
      "parameters": {
        "jsCode": "return [{\n  json: {\n    cantidad_rows: items[0].json.rows.length\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-2048, -112],
      "id": "5a56b075-66d8-406a-9ebe-87cd4d9423f6",
      "name": "CANTIDAD DE FILAS"
    },
    {
      "parameters": {
        "jsCode": "// Esta funciÃ³n escapa caracteres especiales para Markdown V2 de Telegram\nconst escape = (t) => String(t ?? '').replace(/([_*\\[\\]()~`>#+\\-=|{}.!])/g, '\\\\$1');\n\nconst rows = $('Oracle Database').item.json.rows; \n\nlet mensaje = 'ðŸš¨ *Empresa\\\\_Megadatos* ðŸš¨\\n*INFORMACION\\\\_PROCESOS\\\\_FALLIDOS\\\\_CORTES*\\n\\n';\n\nrows.forEach((fila, i) => {\n  mensaje +=\n    `*ESTADO*: \\`${escape(fila.ESTADO)}\\`\\n` +\n    `*NUM\\\\_REGISTROS*: \\`${escape(fila.NUM_REGISTROS)}\\`\\n` +\n    `*OBSERVACION*: \\`${escape(fila.OBSERVACION)}\\`\\n` +\n    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n';\n});\n\nreturn [{json: {mensaje}}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-1824, -112],
      "id": "e5add8d8-9df6-4529-962d-03c64a6ae290",
      "name": "JUNTAR MENSAJES"
    },
    {
      "parameters": {
        "query": "=SELECT IPMD.ESTADO,\n       COUNT(1) AS NUM_REGISTROS\nFROM   DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_DET IPMD\n       INNER JOIN DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_CAB IPMC\n           ON IPMC.ID_PROCESO_MASIVO_CAB = IPMD.PROCESO_MASIVO_CAB_ID\nWHERE  IPMD.FE_CREACION BETWEEN TO_TIMESTAMP('{{ $('SETEAR FECHAS').item.json.fecha_inicio }}', 'DD/MM/RRRR HH24:MI:SS.FF')\n                            AND TO_TIMESTAMP('{{ $('SETEAR FECHAS').item.json.fecha_fin }}', 'DD/MM/RRRR HH24:MI:SS.FF')\n       AND IPMC.TIPO_PROCESO = 'CortarCliente'\n       AND IPMC.EMPRESA_ID = 18\nGROUP BY IPMD.ESTADO"
      },
      "type": "n8n-nodes-oracle-database-parameterization.Oracle Database with Parameterization",
      "typeVersion": 1,
      "position": [-1600, -112],
      "id": "7da588c0-3055-4e47-801d-3ea5f5d9d523",
      "name": "CANTIDAD DE FALLOS",
      "credentials": {
        "oracleCredentials": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [-480, -16],
      "id": "bbc3a01a-eeb4-4ddc-ade1-c66956c9ffe8",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('BANDERA EMPRESA 18').item.json.banderaEmpresa18 }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "6e7a153a-6bad-4064-ae6a-4a866a5ec8d1"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8b951cd0-7225-46cb-80fa-133c05f5fa47",
                    "leftValue": "={{ $('BANDERA EMPRESA 33').item.json.banderaEmpresa33 }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "allMatchingOutputs": true
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [-2720, 80],
      "id": "9e520255-8779-4ed4-8568-5053e76779a0",
      "name": "Switch"
    },
    {
      "parameters": {
        "query": "=SELECT\n  IPMD.ESTADO,\n  COUNT(1) AS NUM_REGISTROS,\n  IPMD.OBSERVACION\nFROM\n  DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_DET IPMD\n  INNER JOIN DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_CAB IPMC\n    ON IPMC.ID_PROCESO_MASIVO_CAB = IPMD.PROCESO_MASIVO_CAB_ID\nWHERE\n  IPMD.FE_CREACION BETWEEN TO_TIMESTAMP('{{ $json.fecha_inicio }}', 'DD/MM/YYYY HH24:MI:SS.FF')\n    AND TO_TIMESTAMP('{{ $json.fecha_fin }}', 'DD/MM/YYYY HH24:MI:SS.FF')\n  AND IPMC.TIPO_PROCESO = 'CortarCliente'\n  AND IPMC.EMPRESA_ID = 33\n  AND IPMD.ESTADO = 'Fallo'\nGROUP BY\n  IPMD.ESTADO,\n  IPMD.OBSERVACION"
      },
      "type": "n8n-nodes-oracle-database-parameterization.Oracle Database with Parameterization",
      "typeVersion": 1,
      "position": [-2272, 272],
      "id": "eeed3692-3df0-4584-8185-9284db442b2c",
      "name": "Oracle Database1",
      "credentials": {
        "oracleCredentials": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "chatId": "",
        "text": "=*ðŸ›‘ðŸš¨ ALERTA CRÃTICA EN CORTES ðŸš¨ðŸ›‘*\n\nSe han identificado *{{ $('CANTIDAD DE FALLOS1').item.json.rows[0].NUM_REGISTROS }}* procesos con fallo en el sistema\\.\n\nRequiere atenciÃ³n urgente\\.",
        "additionalFields": {
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [-256, 80],
      "id": "f5e27ad6-2fb4-4bf1-9ced-8d983ad76e5c",
      "name": "Send a text message",
      "webhookId": "",
      "credentials": {
        "telegramApi": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "chatId": "",
        "text": "={{ $('JUNTAR MENSAJES1').item.json.mensaje }}",
        "additionalFields": {
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [-32, 80],
      "id": "71aeb52d-91bd-495c-bcea-9dd358e2b0f6",
      "name": "Send a text message3",
      "webhookId": "",
      "credentials": {
        "telegramApi": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "jsCode": "return [{\n  json: {\n    cantidad_rows: items[0].json.rows.length\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-2048, 272],
      "id": "24ea48f0-6ad8-47d7-b681-9c4433abafcf",
      "name": "CANTIDAD DE FILAS1"
    },
    {
      "parameters": {
        "jsCode": "// Esta funciÃ³n escapa caracteres especiales para Markdown V2 de Telegram\nconst escape = (t) => String(t ?? '').replace(/([_*\\[\\]()~`>#+\\-=|{}.!])/g, '\\\\$1');\n\nconst rows = $('Oracle Database1').item.json.rows; // Cambia el nombre del nodo si es necesario\nlet mensaje = 'ðŸš¨ *Empresa\\\\_Ecuanet* ðŸš¨\\n*INFORMACION\\\\_PROCESOS\\\\_FALLIDOS\\\\_CORTES*\\n\\n';\n\nrows.forEach((fila, i) => {\n  mensaje +=\n    `*ESTADO*: \\`${escape(fila.ESTADO)}\\`\\n` +\n    `*NUM\\\\_REGISTROS*: \\`${escape(fila.NUM_REGISTROS)}\\`\\n` +\n    `*OBSERVACION*: \\`${escape(fila.OBSERVACION)}\\`\\n` +\n    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n';\n});\n\nreturn [{json: {mensaje}}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-1824, 272],
      "id": "90de8c39-e21d-4ef2-93f4-7737f0523db4",
      "name": "JUNTAR MENSAJES1"
    },
    {
      "parameters": {
        "query": "=SELECT IPMD.ESTADO,\n       COUNT(1) AS NUM_REGISTROS\nFROM   DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_DET IPMD\n       INNER JOIN DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_CAB IPMC\n           ON IPMC.ID_PROCESO_MASIVO_CAB = IPMD.PROCESO_MASIVO_CAB_ID\nWHERE  IPMD.FE_CREACION BETWEEN TO_TIMESTAMP('{{ $('SETEAR FECHAS1').item.json.fecha_inicio }}', 'DD/MM/RRRR HH24:MI:SS.FF')\n                            AND TO_TIMESTAMP('{{ $('SETEAR FECHAS1').item.json.fecha_fin }}', 'DD/MM/RRRR HH24:MI:SS.FF')\n       AND IPMC.TIPO_PROCESO = 'CortarCliente'\n       AND IPMC.EMPRESA_ID = 33\nGROUP BY IPMD.ESTADO"
      },
      "type": "n8n-nodes-oracle-database-parameterization.Oracle Database with Parameterization",
      "typeVersion": 1,
      "position": [-1600, 272],
      "id": "19c5db15-c6d9-47dd-ba3e-626dc9d157fd",
      "name": "CANTIDAD DE FALLOS1",
      "credentials": {
        "oracleCredentials": {
          "id": " ",
          "name": ""
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [-480, 368],
      "id": "673ba1bd-4193-40b5-8706-3b27e67e86fa",
      "name": "No Operation, do nothing1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "897bdfb0-7e40-422a-b224-0fb11a5b8f4f",
              "name": "fecha_inicio",
              "value": "={{ (() => {   const d = new Date();   const dd = String(d.getDate()).padStart(2, '0');   const mm = String(d.getMonth()+1).padStart(2, '0');   const yyyy = d.getFullYear();   return `${dd}/${mm}/${yyyy} 00:00:00.000000`; })() }}",
              "type": "string"
            },
            {
              "id": "f97db624-dc43-43aa-bb50-34aec49ace96",
              "name": "fecha_fin",
              "value": "={{ (() => {   const d = new Date();   const dd = String(d.getDate()).padStart(2, '0');   const mm = String(d.getMonth()+1).padStart(2, '0');   const yyyy = d.getFullYear();   return `${dd}/${mm}/${yyyy} 23:59:59.000000`; })() }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [-2496, 272],
      "id": "9ef6ff6c-0664-4c18-b14a-a10e57d65f55",
      "name": "SETEAR FECHAS1"
    },
    {
      "parameters": {
        "jsCode": "// Lee filas desde el nodo \"CANTIDAD DE FALLOS\"\nlet rows = $('CANTIDAD DE FALLOS').item?.json?.rows;\nif (!Array.isArray(rows)) {\n  const src = $('CANTIDAD DE FALLOS').item?.json;\n  rows = Array.isArray(src) ? src : (src?.rows ?? []);\n}\n\n// Normalizador\nconst norm = (v) => String(v ?? '').toLowerCase().trim();\nconst num = (v) => {\n  const n = Number(v);\n  return Number.isFinite(n) ? n : 0;\n};\n\n// Banderas\nlet pendiente = false;\nlet procesando = false;\nlet fallo = false;\n\n// Recorre todas las rows\nfor (const r of rows || []) {\n  const estado = norm(\n    r.ESTADO ?? r.estado ?? r.Status ?? r.status ?? r.estadoNombre ?? ''\n  );\n\n  const cantidad = num(\n    r.NUM_REGISTROS ?? r.CANTIDAD ?? r.TOTAL ?? r.COUNT ?? r.count ?? r.total ?? r.cantidad ?? 0\n  );\n\n  if (cantidad > 0) {\n    if (estado.includes('pendiente')) pendiente = true;\n    if (estado.includes('proces')) procesando = true;\n    if (estado.includes('fallo')) fallo = true; // <- Este es el cambio clave\n  }\n\n  if (pendiente && procesando && fallo) break;\n}\n\n// Devuelve las 3 banderas\nreturn [{ json: { pendiente, procesando, fallo } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-928, -112],
      "id": "183e1591-a47a-43a5-b18c-41ed10514721",
      "name": "BANDERA PENDIENTE Y FALLOS"
    },
    {
      "parameters": {
        "jsCode": "// Lee filas desde el nodo \"CANTIDAD DE FALLOS1\"\nlet rows = $('CANTIDAD DE FALLOS1').item?.json?.rows;\nif (!Array.isArray(rows)) {\n  const src = $('CANTIDAD DE FALLOS1').item?.json;\n  rows = Array.isArray(src) ? src : (src?.rows ?? []);\n}\n\n// Normalizador\nconst norm = (v) => String(v ?? '').toLowerCase().trim();\nconst num = (v) => {\n  const n = Number(v);\n  return Number.isFinite(n) ? n : 0;\n};\n\n// Banderas\nlet pendiente = false;\nlet procesando = false;\nlet fallo = false;\n\n// Recorre todas las rows\nfor (const r of rows || []) {\n  const estado = norm(\n    r.ESTADO ?? r.estado ?? r.Status ?? r.status ?? r.estadoNombre ?? ''\n  );\n\n  const cantidad = num(\n    r.NUM_REGISTROS ?? r.CANTIDAD ?? r.TOTAL ?? r.COUNT ?? r.count ?? r.total ?? r.cantidad ?? 0\n  );\n\n  const cantidadFallos = num(\n    r.FALLOS ?? r.fallos ?? r.ERRORES ?? r.errores ?? r.fallo ?? r.error ?? 0\n  );\n\n  if (cantidad > 0) {\n    if (estado.includes('pendiente')) pendiente = true;\n    if (estado.includes('proces')) procesando = true;\n    if (estado.includes('fallo')) fallo = true; // ðŸ”§ <<--- CORRECCIÃ“N CLAVE\n  }\n\n  if (cantidadFallos > 0) {\n    fallo = true;\n  }\n\n  if (pendiente && procesando && fallo) break;\n}\n\n// Devuelve las 3 banderas\nreturn [{ json: { pendiente, procesando, fallo } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-928, 272],
      "id": "a9fc2fa3-514e-4556-9f22-87d572c1d903",
      "name": "BANDERA PENDIENTE Y FALLOS1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "21d58c09-b34f-41be-aaec-310a550c2070",
              "leftValue": "={{ $('BANDERA PENDIENTE Y FALLOS').item.json.fallo }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [-480, -208],
      "id": "28e3792a-1fea-42bf-9f5a-dcd2fac64c8f",
      "name": "CONDICIONAL FALLOS"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "402e1328-1ddc-42d4-a342-4adb2f3ea9fc",
              "leftValue": "={{ $('BANDERA PENDIENTE Y FALLOS1').item.json.fallo }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [-480, 176],
      "id": "17ca98cf-8bd3-4acd-8491-17ceaa5acee0",
      "name": "CONDICIONAL FALLOS1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "35155333-2ace-4ba2-ac32-76046028f20d",
              "leftValue": "={{ $json.pendiente }}",
              "rightValue": "Pendiente",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            },
            {
              "id": "82082f2e-74a6-4930-a614-65d1d255d078",
              "leftValue": "={{ $json.procesando }}",
              "rightValue": 0,
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [-704, -112],
      "id": "f18dd733-e186-46d1-99c3-2a247258a117",
      "name": "CONDICIONAL PENDIENTES"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "35155333-2ace-4ba2-ac32-76046028f20d",
              "leftValue": "={{ $json.pendiente }}",
              "rightValue": 0,
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            },
            {
              "id": "a36a8c55-87f5-460b-9dc6-30e741cca226",
              "leftValue": "={{ $json.procesando }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [-704, 272],
      "id": "dcf19a20-4ee3-4b91-966c-c031fa6a0566",
      "name": "CONDICIONAL PENDIENTES1"
    },
    {
      "parameters": {
        "query": "=SELECT IPMD.ESTADO,\n       COUNT(1) AS NUM_REGISTROS\nFROM   DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_DET IPMD\n       INNER JOIN DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_CAB IPMC\n           ON IPMC.ID_PROCESO_MASIVO_CAB = IPMD.PROCESO_MASIVO_CAB_ID\nWHERE  IPMD.FE_CREACION BETWEEN TO_TIMESTAMP('{{ $json.fecha_inicio }}', 'DD/MM/RRRR HH24:MI:SS.FF')\n                            AND TO_TIMESTAMP('{{ $json.fecha_fin }}', 'DD/MM/RRRR HH24:MI:SS.FF')\n       AND IPMC.TIPO_PROCESO = 'CortarCliente'\n       AND IPMC.EMPRESA_ID = 18\nGROUP BY IPMD.ESTADO"
      },
      "type": "n8n-nodes-oracle-database-parameterization.Oracle Database with Parameterization",
      "typeVersion": 1,
      "position": [-4736, 272],
      "id": "54d3e07f-370d-47a0-909a-467fa1297b0f",
      "name": "Oracle Database2",
      "credentials": {
        "oracleCredentials": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "21d58c09-b34f-41be-aaec-310a550c2070",
              "leftValue": "={{ $json.banderaPendientesMas2000 }}",
              "rightValue": 2000,
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [-3168, 80],
      "id": "5cb1a61b-ad13-4cc0-aba0-b4c9d6613b94",
      "name": "CONDICIONAL FALLOS2"
    },
    {
      "parameters": {
        "amount": 2,
        "unit": "minutes"
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [-2944, 16],
      "id": "16bb60b0-1cfb-4e1c-81a8-92b9ca93a89e",
      "name": "Wait",
      "webhookId": ""
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "897bdfb0-7e40-422a-b224-0fb11a5b8f4f",
              "name": "fecha_inicio",
              "value": "={{ (() => {   const d = new Date();   const dd = String(d.getDate()).padStart(2, '0');   const mm = String(d.getMonth()+1).padStart(2, '0');   const yyyy = d.getFullYear();   return `${dd}/${mm}/${yyyy} 00:00:00.000000`; })() }}",
              "type": "string"
            },
            {
              "id": "f97db624-dc43-43aa-bb50-34aec49ace96",
              "name": "fecha_fin",
              "value": "={{ (() => {   const d = new Date();   const dd = String(d.getDate()).padStart(2, '0');   const mm = String(d.getMonth()+1).padStart(2, '0');   const yyyy = d.getFullYear();   return `${dd}/${mm}/${yyyy} 23:59:59.000000`; })() }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [-4960, 272],
      "id": "2ec84dd5-71e4-40df-afe6-41afd2f75e76",
      "name": "SETEAR FECHAS2"
    },
    {
      "parameters": {
        "jsCode": "// Obtener las filas del nodo \"Oracle Database2\"\nconst rows = $('Oracle Database2').item.json.rows;\n\n// Inicializar la bandera\nlet banderaPendientesMas2000 = false;\n\n// Recorrer las filas\nfor (const fila of rows) {\n  // Verificamos si el estado es 'Pendiente' o 'Procesando' y hay mÃ¡s de 2000 registros\n  if ((fila.ESTADO === 'Pendiente' || fila.ESTADO === 'Procesando') && Number(fila.NUM_REGISTROS) > 2000) {\n    banderaPendientesMas2000 = true;\n    break; // Salimos del bucle al encontrar la condiciÃ³n\n  }\n}\n\n// Retornar la bandera como salida\nreturn [{ json: { banderaPendientesMas2000 } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-3392, 80],
      "id": "7de97ce8-acf1-4836-96b2-182e483c3244",
      "name": "Code"
    },
    {
      "parameters": {
        "jsCode": "// FunciÃ³n para escapar caracteres reservados en MarkdownV2\nconst escape = (text) => {\n  return String(text ?? '')\n    .replace(/\\\\/g, '\\\\\\\\')\n    .replace(/([_*\\[\\]()~`>#+=|{}.!-])/g, '\\\\$1');\n};\n\n// Obtener los datos del nodo anterior\nconst rows = $('CANTIDAD DE FALLOS').item.json.rows;\n\n// Obtener fecha actual en formato YYYY-MM-DD escapado para MarkdownV2\nconst fecha = escape(new Date().toISOString().split('T')[0]); // ej: 2025-09-09\n\n// Construir mensaje principal\nlet mensaje = `*ðŸ“… Fecha:* \\`${fecha}\\`\\n*âš ï¸ INFORMACIÃ“N DE PROCESOS MASIVOS CORTES MEGADATOS âš ï¸*\\n\\n`;\n\nrows.forEach(row => {\n  mensaje += \n    `*Estado*: \\`${escape(row.ESTADO)}\\`\\n` +\n    `*NÃºmero de Registros*: \\`${escape(row.NUM_REGISTROS)}\\`\\n` +\n    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n';\n});\n\nreturn [{ json: { mensaje } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-1376, -112],
      "id": "24ad0e43-8b0b-47f1-93d5-7dc98b9586bd",
      "name": "UNIR MENSAJES INFO"
    },
    {
      "parameters": {
        "chatId": "",
        "text": "={{ $('UNIR MENSAJES INFO').item.json.mensaje }}",
        "additionalFields": {
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [-1152, -112],
      "id": "1da02dce-4a58-4b8e-96eb-9b95051299cb",
      "name": "Send a text message4",
      "webhookId": "",
      "credentials": {
        "telegramApi": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// FunciÃ³n para escapar caracteres reservados en MarkdownV2\nconst escape = (text) => {\n  return String(text ?? '')\n    .replace(/\\\\/g, '\\\\\\\\')\n    .replace(/([_*\\[\\]()~`>#+=|{}.!-])/g, '\\\\$1');\n};\n\n// Obtener los datos del nodo anterior\nconst rows = $('CANTIDAD DE FALLOS1').item.json.rows;\n\n// Obtener fecha actual en formato YYYY-MM-DD escapado para MarkdownV2\nconst fecha = escape(new Date().toISOString().split('T')[0]); // ej: 2025-09-09\n\n// Construir mensaje principal\nlet mensaje = `*ðŸ“… Fecha:* \\`${fecha}\\`\\n*âš ï¸ INFORMACIÃ“N DE PROCESOS MASIVOS CORTES ECUANET âš ï¸*\\n\\n`;\n\nrows.forEach(row => {\n  mensaje += \n    `*Estado*: \\`${escape(row.ESTADO)}\\`\\n` +\n    `*NÃºmero de Registros*: \\`${escape(row.NUM_REGISTROS)}\\`\\n` +\n    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n';\n});\n\nreturn [{ json: { mensaje } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-1376, 272],
      "id": "5c6344b2-8239-4401-b237-ad74591f0bf6",
      "name": "UNIR MENSAJES INFO1"
    },
    {
      "parameters": {
        "chatId": "",
        "text": "={{ $('UNIR MENSAJES INFO1').item.json.mensaje }}",
        "additionalFields": {
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [-1152, 272],
      "id": "e8234a85-d298-4c33-bf40-ee757b669988",
      "name": "Send a text message5",
      "webhookId": "",
      "credentials": {
        "telegramApi": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Obtener las filas de ambos nodos\nconst rowsDB2 = $('Oracle Database2').item.json.rows;\nconst rowsDB3 = $('Oracle Database3').item.json.rows;\n\n// Combinar las filas de ambos nodos en un solo array\nconst allRows = [...rowsDB2, ...rowsDB3];\n\n// Inicializar la bandera\nlet banderaPendientesMas1000 = false;\n\n// Recorrer todas las filas combinadas\nfor (const fila of allRows) {\n  // Verificamos si el estado es 'Pendiente' o 'Procesando' y los registros son mÃ¡s de 1000\n  if ((fila.ESTADO === 'Pendiente' || fila.ESTADO === 'Procesando') && Number(fila.NUM_REGISTROS) > 1) {\n    banderaPendientesMas1000 = true;\n    break; // Salimos del bucle al encontrar la condiciÃ³n\n  }\n}\n\n// Retornar la bandera como salida\nreturn [{ json: { banderaPendientesMas1000 } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-3840, 272],
      "id": "02d8097a-f889-4b7d-bdee-48484ce5cf13",
      "name": "Code1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "21d58c09-b34f-41be-aaec-310a550c2070",
              "leftValue": "={{ $json.banderaPendientesMas1000 }}",
              "rightValue": 2000,
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [-3616, 272],
      "id": "80878813-a099-4932-9f3a-0bab053346c4",
      "name": "CONDICIONAL FALLOS3"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [-3392, 368],
      "id": "925641bc-bbc8-4104-9611-e4443f52764d",
      "name": "No Operation, do nothing4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4c3dc594-ba08-472d-98ff-030b3f8a1dd1",
              "name": "hora_actual",
              "value": "={{ (new Date()).getHours() }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [-5632, 656],
      "id": "ea6659e7-a907-4e0f-b9f9-ecf9106da653",
      "name": "SET HORA ACTUAL"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4ad9ad7a-e6c3-43b4-b15e-389713a09b68",
              "leftValue": "={{ $json.hora_actual }}",
              "rightValue": 6,
              "operator": {
                "type": "number",
                "operation": "lt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [-5408, 656],
      "id": "06566458-e162-4778-b729-fd8ad212d16c",
      "name": "IF ENTRE 0 Y 6"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 3
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [-6976, 368],
      "id": "daf0eb33-9277-41d7-bf7d-d57e1c294cb0",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "chatId": "",
        "text": "=âœ… *Monitoreo Suspension Cliente Megadatos* no existe ninguna *novedad* ",
        "additionalFields": {
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [-256, -304],
      "id": "cf9d6f07-9742-415a-a458-89af0fea4bfc",
      "name": "Send a text message6",
      "webhookId": "",
      "credentials": {
        "telegramApi": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "chatId": "",
        "text": "=âœ… *Monitoreo Suspension Cliente Ecuanet* no existe ninguna *novedad* ",
        "additionalFields": {
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [-256, 272],
      "id": "6faa22c2-4ef5-4b99-846c-02b456161024",
      "name": "Send a text message7",
      "webhookId": "",
      "credentials": {
        "telegramApi": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "query": "=SELECT IPMD.ESTADO, COUNT (*) AS NUM_REGISTROS    FROM DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_DET IPMD\n         INNER JOIN DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_CAB IPMC             ON IPMC.ID_PROCESO_MASIVO_CAB = IPMD.PROCESO_MASIVO_CAB_ID\n   WHERE     IPMD.FE_CREACION BETWEEN TO_TIMESTAMP ( '{{ $('SETEAR FECHAS2').item.json.fecha_inicio }}', 'DD/MM/RRRR HH24:MI:SS.FF') \n                                  AND TO_TIMESTAMP ( '{{ $('SETEAR FECHAS2').item.json.fecha_fin }}','DD/MM/RRRR HH24:MI:SS.FF')\n         AND IPMC.TIPO_PROCESO = 'CortarCliente'         \n         AND IPMC.EMPRESA_ID = 33\n         GROUP BY IPMD.ESTADO"
      },
      "type": "n8n-nodes-oracle-database-parameterization.Oracle Database with Parameterization",
      "typeVersion": 1,
      "position": [-4288, 272],
      "id": "d2232211-f0b8-40d6-9862-282316423ad1",
      "name": "Oracle Database3",
      "credentials": {
        "oracleCredentials": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const rows = $('Oracle Database2').item.json.rows;\nlet activa = false;\n\nfor (const fila of rows) {\n  if (\n    ['Pendiente', 'Procesando', 'Fallo'].includes(fila.ESTADO) &&\n    Number(fila.NUM_REGISTROS) > 0\n  ) {\n    activa = true;\n    break;\n  }\n}\n\nreturn [{ json: { banderaEmpresa18: activa } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-4512, 272],
      "id": "2842abbe-3fbd-4c60-985a-85cc89ef3bbc",
      "name": "BANDERA EMPRESA 18"
    },
    {
      "parameters": {
        "jsCode": "const rows = $('Oracle Database3').item.json.rows;\nlet activa = false;\n\nfor (const fila of rows) {\n  if (\n    ['Pendiente', 'Procesando', 'Fallo'].includes(fila.ESTADO) &&\n    Number(fila.NUM_REGISTROS) > 0\n  ) {\n    activa = true;\n    break;\n  }\n}\n\nreturn [{ json: { banderaEmpresa33: activa } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-4064, 272],
      "id": "9f29c1a4-96be-47b9-b83e-cbed48d18fba",
      "name": "BANDERA EMPRESA 33"
    },
    {
      "parameters": {
        "query": "=SELECT IPMD.ESTADO,\n       COUNT(1) AS NUM_REGISTROS\nFROM   DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_DET IPMD\n       INNER JOIN DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_CAB IPMC\n           ON IPMC.ID_PROCESO_MASIVO_CAB = IPMD.PROCESO_MASIVO_CAB_ID\nWHERE  IPMD.FE_CREACION BETWEEN TO_TIMESTAMP('{{ $json.fecha_inicio }}', 'DD/MM/RRRR HH24:MI:SS.FF')\n                            AND TO_TIMESTAMP('{{ $json.fecha_fin }}', 'DD/MM/RRRR HH24:MI:SS.FF')\n       AND IPMC.TIPO_PROCESO = 'CortarCliente'\n       AND IPMC.EMPRESA_ID = 18\nGROUP BY IPMD.ESTADO"
      },
      "type": "n8n-nodes-oracle-database-parameterization.Oracle Database with Parameterization",
      "typeVersion": 1,
      "position": [-6528, 368],
      "id": "dbdae5aa-7ffb-41e8-8b27-b2b784d3cd6e",
      "name": "Oracle Database4",
      "credentials": {
        "oracleCredentials": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Obtener las filas de ambos nodos\nconst rowsDB2 = $('Oracle Database4').item.json.rows;\nconst rowsDB3 = $('Oracle Database5').item.json.rows;\n\n// Combinar las filas de ambos nodos en un solo array\nconst allRows = [...rowsDB2, ...rowsDB3];\n\n// Inicializar la bandera\nlet banderaPendientesMas1000 = false;\n\n// Recorrer todas las filas combinadas\nfor (const fila of allRows) {\n  // Verificamos si el estado es 'Pendiente' o 'Procesando' y los registros son mÃ¡s de 1000\n  if ((fila.ESTADO === 'Pendiente' || fila.ESTADO === 'Procesando') && Number(fila.NUM_REGISTROS) > 1) {\n    banderaPendientesMas1000 = true;\n    break; // Salimos del bucle al encontrar la condiciÃ³n\n  }\n}\n\n// Retornar la bandera como salida\nreturn [{ json: { banderaPendientesMas1000 } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-6080, 368],
      "id": "8cf6be06-796e-43a9-b2b3-c97857cff425",
      "name": "Code2"
    },
    {
      "parameters": {
        "query": "=SELECT IPMD.ESTADO, COUNT (*) AS NUM_REGISTROS    FROM DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_DET IPMD\n         INNER JOIN DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_CAB IPMC             ON IPMC.ID_PROCESO_MASIVO_CAB = IPMD.PROCESO_MASIVO_CAB_ID\n   WHERE     IPMD.FE_CREACION BETWEEN TO_TIMESTAMP ( '{{ $('SETEAR FECHAS3').item.json.fecha_inicio }}', 'DD/MM/RRRR HH24:MI:SS.FF') \n                                  AND TO_TIMESTAMP ( '{{ $('SETEAR FECHAS3').item.json.fecha_fin }}','DD/MM/RRRR HH24:MI:SS.FF')\n         AND IPMC.TIPO_PROCESO = 'CortarCliente'         \n         AND IPMC.EMPRESA_ID = 33\n         GROUP BY IPMD.ESTADO"
      },
      "type": "n8n-nodes-oracle-database-parameterization.Oracle Database with Parameterization",
      "typeVersion": 1,
      "position": [-6304, 368],
      "id": "de1fcece-1d07-4721-9df3-7f962541a767",
      "name": "Oracle Database5",
      "credentials": {
        "oracleCredentials": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.banderaPendientesMas1000 }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    },
                    "id": "0c66b301-cbac-4272-96f9-5970be126f88"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ENCENDER FLUJOS"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d9620fa1-7ffe-4b0c-b42e-426d9c2f8dc5",
                    "leftValue": "1",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "FLUJO CORTES"
            }
          ]
        },
        "options": {
          "allMatchingOutputs": true
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [-5856, 368],
      "id": "eb2256d1-1c2b-4ce2-9734-09b4b6fae5ba",
      "name": "Switch1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "897bdfb0-7e40-422a-b224-0fb11a5b8f4f",
              "name": "fecha_inicio",
              "value": "={{ (() => {   const d = new Date();   const dd = String(d.getDate()).padStart(2, '0');   const mm = String(d.getMonth()+1).padStart(2, '0');   const yyyy = d.getFullYear();   return `${dd}/${mm}/${yyyy} 00:00:00.000000`; })() }}",
              "type": "string"
            },
            {
              "id": "f97db624-dc43-43aa-bb50-34aec49ace96",
              "name": "fecha_fin",
              "value": "={{ (() => {   const d = new Date();   const dd = String(d.getDate()).padStart(2, '0');   const mm = String(d.getMonth()+1).padStart(2, '0');   const yyyy = d.getFullYear();   return `${dd}/${mm}/${yyyy} 23:59:59.000000`; })() }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [-6752, 368],
      "id": "c15c6009-6961-4556-bfc6-6f26216fbdc8",
      "name": "SETEAR FECHAS3"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [-5184, 272],
      "id": "be9ca1e3-5445-4843-bbb5-f72c00f7cde4",
      "name": "No Operation, do nothing2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-N8N-API-KEY",
              "value": ""
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [-5632, -16],
      "id": "67a31234-8433-4a1c-9f1e-212875ad8544",
      "name": "ENCENDER BUS"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-N8N-API-KEY",
              "value": ""
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [-5408, -16],
      "id": "2118be68-f913-4bbb-8a12-cb1feb56d266",
      "name": "ENCENDER BUS RESUMEN"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-N8N-API-KEY",
              "value": ""
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [-5184, -16],
      "id": "ee9fbc71-caa9-4542-ad37-a06630bb652e",
      "name": "ENCENDER REACTIVACIONES"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "X-N8N-API-KEY",
              "value": ""
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [-4960, -16],
      "id": "f757a20a-a5e3-447b-ac57-536ae821a50d",
      "name": "ENCENDER REACTIVACIONES RESUMEN"
    },
    {
      "parameters": {
        "query": "=SELECT \n  CASE \n    WHEN SUM(CASE WHEN IPMD.ESTADO IN ('Pendiente', 'Procesando') THEN 1 ELSE 0 END) = 0 \n         AND SUM(CASE WHEN IPMD.ESTADO in ( 'In-Corte','Finalizada') THEN 1 ELSE 0 END) > 0\n    THEN 'Lote finalizado'\n    ELSE 'Procesos pendientes o en ejecuciÃ³n'\n  END AS ESTADO_LOTE\nFROM DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_DET IPMD\nINNER JOIN DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_CAB IPMC \n  ON IPMC.ID_PROCESO_MASIVO_CAB = IPMD.PROCESO_MASIVO_CAB_ID\nWHERE IPMD.FE_CREACION BETWEEN TO_TIMESTAMP('{{ $('SETEAR FECHAS3').item.json.fecha_inicio }}', 'DD/MM/RRRR HH24:MI:SS.FF')\n                           AND TO_TIMESTAMP('{{ $('SETEAR FECHAS3').item.json.fecha_fin }}','DD/MM/RRRR HH24:MI:SS.FF')\n  AND IPMC.TIPO_PROCESO = 'CortarCliente'\n  AND IPMC.EMPRESA_ID = 33"
      },
      "type": "n8n-nodes-oracle-database-parameterization.Oracle Database with Parameterization",
      "typeVersion": 1,
      "position": [-4736, 848],
      "id": "bd880266-14a2-4535-8185-677e9cd61023",
      "name": "Oracle Database6",
      "credentials": {
        "oracleCredentials": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4c3dc594-ba08-472d-98ff-030b3f8a1dd1",
              "name": "hora_actual",
              "value": "={{ (new Date()).getHours() }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [-4960, 848],
      "id": "c9f379b3-c782-44f3-bdaa-0edd78a5cc3f",
      "name": "SET HORA ACTUAL1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4c3dc594-ba08-472d-98ff-030b3f8a1dd1",
              "name": "hora_actual",
              "value": "={{ (new Date()).getHours() }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [-4960, 1232],
      "id": "6daa4b19-0711-4710-b80f-8c6fc9eb5dc4",
      "name": "SET HORA ACTUAL2"
    },
    {
      "parameters": {
        "query": "=SELECT \n  CASE \n    WHEN SUM(CASE WHEN IPMD.ESTADO IN ('Pendiente', 'Procesando') THEN 1 ELSE 0 END) = 0 \n         AND SUM(CASE WHEN IPMD.ESTADO in ( 'In-Corte','Finalizada') THEN 1 ELSE 0 END) > 0\n    THEN 'Lote finalizado'\n    ELSE 'Procesos pendientes o en ejecuciÃ³n'\n  END AS ESTADO_LOTE\nFROM DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_DET IPMD\nINNER JOIN DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_CAB IPMC \n  ON IPMC.ID_PROCESO_MASIVO_CAB = IPMD.PROCESO_MASIVO_CAB_ID\nWHERE IPMD.FE_CREACION BETWEEN TO_TIMESTAMP('{{ $('SETEAR FECHAS3').item.json.fecha_inicio }}', 'DD/MM/RRRR HH24:MI:SS.FF')\n                           AND TO_TIMESTAMP('{{ $('SETEAR FECHAS3').item.json.fecha_fin }}','DD/MM/RRRR HH24:MI:SS.FF')\n  AND IPMC.TIPO_PROCESO = 'CortarCliente'\n  AND IPMC.EMPRESA_ID = 18"
      },
      "type": "n8n-nodes-oracle-database-parameterization.Oracle Database with Parameterization",
      "typeVersion": 1,
      "position": [-4736, 1232],
      "id": "904b2f67-0158-4fe5-ba15-1e22ac2d5ee5",
      "name": "Oracle Database7",
      "credentials": {
        "oracleCredentials": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "55e66722-286a-42c0-81aa-265c8138c2da",
              "leftValue": "={{ $json.rows[0].ESTADO_LOTE }}",
              "rightValue": "Lote finalizado",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [-4512, 848],
      "id": "d29f6bb5-845e-4ddb-9ac0-c3bf60f666b7",
      "name": "If"
    },
    {
      "parameters": {
        "fileSelector": "/tmp/mensajeEcuanet.lock",
        "options": {}
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [-4288, 656],
      "id": "84b44227-c0a6-42c9-815c-8e93c9d203ad",
      "name": "leer",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "/tmp/mensajeEcuanet.lock",
        "dataPropertyName": "locked",
        "options": {
          "append": false
        }
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [-3616, 560],
      "id": "f2a0d3e5-dd05-4470-87c5-e6524af58394",
      "name": "ESCRIBIR"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "45b601e3-f201-4eca-8637-d525b40b39a8",
              "leftValue": "={{ $binary.data }}",
              "rightValue": "1",
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [-4064, 656],
      "id": "f6357ef3-66a7-4f73-88c5-6ef73cfad1f1",
      "name": "If1"
    },
    {
      "parameters": {
        "jsCode": "return [\n  {\n    binary: {\n      locked: {\n        data: Buffer.from(\"locked\").toString(\"base64\"),\n        mimeType: \"text/plain\",\n        fileName: \"mensajeEcuanet.lock\"\n      }\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-3840, 560],
      "id": "c2ace831-e943-459c-a3b3-29d56dbb0f17",
      "name": "Code3"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [-3840, 752],
      "id": "60bcb3a5-3ae9-4883-8aa5-3cdd604b30e4",
      "name": "No Operation, do nothing5"
    },
    {
      "parameters": {
        "chatId": "",
        "text": "=âœ… Finaliza Ãºltimo lote *Ecuanet*",
        "additionalFields": {
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [-3392, 560],
      "id": "38b42fca-d926-4a9a-9e1c-8232e3cd64f4",
      "name": "Send a text message8",
      "webhookId": "",
      "credentials": {
        "telegramApi": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "55e66722-286a-42c0-81aa-265c8138c2da",
              "leftValue": "={{ $json.rows[0].ESTADO_LOTE }}",
              "rightValue": "Lote finalizado",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [-4512, 1232],
      "id": "8ff1ce0e-af51-4978-9994-f637407719eb",
      "name": "If2"
    },
    {
      "parameters": {
        "fileSelector": "/tmp/mensajeMegadatos.lock",
        "options": {}
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [-4288, 1040],
      "id": "7e0e1152-089f-41b9-92d2-37d1fec07ec2",
      "name": "leer1",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "write",
        "fileName": "/tmp/mensajeMegadatos.lock",
        "dataPropertyName": "locked",
        "options": {
          "append": false
        }
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [-3616, 944],
      "id": "f4ee4fe4-6f3e-4401-b1ff-04818ca825d3",
      "name": "ESCRIBIR1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "45b601e3-f201-4eca-8637-d525b40b39a8",
              "leftValue": "={{ $binary.data }}",
              "rightValue": "1",
              "operator": {
                "type": "object",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [-4064, 1040],
      "id": "4cf3350c-a95c-4897-b87c-874f29467ebc",
      "name": "If3"
    },
    {
      "parameters": {
        "jsCode": "return [\n  {\n    binary: {\n      locked: {\n        data: Buffer.from(\"locked\").toString(\"base64\"),\n        mimeType: \"text/plain\",\n        fileName: \"mensajeMegadatos.lock\"\n      }\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-3840, 944],
      "id": "16477c4a-0149-4715-ba5d-8cae65af0a8b",
      "name": "Code4"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [-3840, 1136],
      "id": "c415f2e8-4265-460a-80cb-832f711849cf",
      "name": "No Operation, do nothing7"
    },
    {
      "parameters": {
        "chatId": "",
        "text": "=âœ… Finaliza Ãºltimo lote *Megadatos*",
        "additionalFields": {
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [-3392, 944],
      "id": "d815fcf0-7886-45cb-ae75-da72b175d55d",
      "name": "Send a text message9",
      "webhookId": "",
      "credentials": {
        "telegramApi": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "command": "rm /tmp/mensajeEcuanet.lock"
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [-4288, 848],
      "id": "70bcfc8a-3079-4068-9850-17f7aa0ec153",
      "name": "BORRAR ARCHIVO",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "command": "rm /tmp/mensajeMegadatos.lock"
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [-4288, 1232],
      "id": "8082f4ce-064c-4513-bf5f-ee50d5cc0784",
      "name": "BORRAR ARCHIVO1",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "query": "=SELECT\n  IPMD.ESTADO,\n  COUNT(1) AS NUM_REGISTROS,\n  IPMD.OBSERVACION\nFROM\n  DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_DET IPMD\n  INNER JOIN DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_CAB IPMC\n    ON IPMC.ID_PROCESO_MASIVO_CAB = IPMD.PROCESO_MASIVO_CAB_ID\nWHERE\n  IPMD.FE_CREACION BETWEEN TO_TIMESTAMP('{{ $('SETEAR FECHAS3').item.json.fecha_inicio }}', 'DD/MM/YYYY HH24:MI:SS.FF')\n    AND TO_TIMESTAMP('{{ $('SETEAR FECHAS3').item.json.fecha_fin }}', 'DD/MM/YYYY HH24:MI:SS.FF')\n  AND IPMC.TIPO_PROCESO = 'CortarCliente'\n  AND IPMC.EMPRESA_ID = 18\n  AND IPMD.ESTADO = 'Fallo'\nGROUP BY\n  IPMD.ESTADO,\n  IPMD.OBSERVACION"
      },
      "type": "n8n-nodes-oracle-database-parameterization.Oracle Database with Parameterization",
      "typeVersion": 1,
      "position": [-3168, 944],
      "id": "2b54e0e2-a2d2-43e9-ad9d-7dfa453c257c",
      "name": "Oracle Database8",
      "credentials": {
        "oracleCredentials": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "jsCode": "return [{\n  json: {\n    cantidad_rows: items[0].json.rows.length\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-2944, 944],
      "id": "4f99ecf4-1e75-4dd4-874b-d81ba991e871",
      "name": "CANTIDAD DE FILAS2"
    },
    {
      "parameters": {
        "jsCode": "// Esta funciÃ³n escapa caracteres especiales para Markdown V2 de Telegram\nconst escape = (t) => String(t ?? '').replace(/([_*\\[\\]()~`>#+\\-=|{}.!])/g, '\\\\$1');\n\nconst rows = $('Oracle Database8').item.json.rows; \n\nlet mensaje = 'ðŸš¨\\n*FALLOS\\\\_CORTES*\\n\\n';\n\nrows.forEach((fila, i) => {\n  mensaje +=\n    `*ESTADO*: \\`${escape(fila.ESTADO)}\\`\\n` +\n    `*NUM\\\\_REGISTROS*: \\`${escape(fila.NUM_REGISTROS)}\\`\\n` +\n    `*OBSERVACION*: \\`${escape(fila.OBSERVACION)}\\`\\n` +\n    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n';\n});\n\nreturn [{json: {mensaje}}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-2720, 944],
      "id": "381abfad-e08e-4f9e-92f4-a1a1e6c57f2c",
      "name": "JUNTAR MENSAJES2"
    },
    {
      "parameters": {
        "query": "=SELECT IPMD.ESTADO,\n       COUNT(1) AS NUM_REGISTROS\nFROM   DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_DET IPMD\n       INNER JOIN DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_CAB IPMC\n           ON IPMC.ID_PROCESO_MASIVO_CAB = IPMD.PROCESO_MASIVO_CAB_ID\nWHERE  IPMD.FE_CREACION BETWEEN TO_TIMESTAMP('{{ $('SETEAR FECHAS3').item.json.fecha_inicio }}', 'DD/MM/RRRR HH24:MI:SS.FF')\n                            AND TO_TIMESTAMP('{{ $('SETEAR FECHAS3').item.json.fecha_fin }}', 'DD/MM/RRRR HH24:MI:SS.FF')\n       AND IPMC.TIPO_PROCESO = 'CortarCliente'\n       AND IPMC.EMPRESA_ID = 18\nGROUP BY IPMD.ESTADO"
      },
      "type": "n8n-nodes-oracle-database-parameterization.Oracle Database with Parameterization",
      "typeVersion": 1,
      "position": [-2496, 944],
      "id": "dc1cb380-257d-4d77-96a3-01ae505e4237",
      "name": "CANTIDAD DE FALLOS2",
      "credentials": {
        "oracleCredentials": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// FunciÃ³n para escapar caracteres reservados en MarkdownV2\nconst escape = (text) => {\n  return String(text ?? '')\n    .replace(/\\\\/g, '\\\\\\\\')\n    .replace(/([_*\\[\\]()~`>#+=|{}.!-])/g, '\\\\$1');\n};\n\n// Obtener los datos del nodo anterior\nconst rows = $('CANTIDAD DE FALLOS2').item.json.rows;\n\n// Obtener fecha actual en formato YYYY-MM-DD escapado para MarkdownV2\nconst fecha = escape(new Date().toISOString().split('T')[0]); // ej: 2025-09-09\n\n// Construir mensaje principal\nlet mensaje = `*ðŸ“… Fecha:* \\`${fecha}\\`\\n*INFORMACIÃ“N FINAL MASIVOS CORTES MEGADATOS*\\n\\n`;\n\nrows.forEach(row => {\n  mensaje += \n    `*Estado*: \\`${escape(row.ESTADO)}\\`\\n` +\n    `*NÃºmero de Registros*: \\`${escape(row.NUM_REGISTROS)}\\`\\n` +\n    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n';\n});\n\nreturn [{ json: { mensaje } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-2272, 944],
      "id": "31b4bde5-a024-4102-a2c9-9a4e4a35995b",
      "name": "UNIR MENSAJES INFO2"
    },
    {
      "parameters": {
        "command": "rm /tmp/mensajeEcuanet.lock"
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [-6976, 1456],
      "id": "61d411af-0a8a-455c-aeff-bd33768305bb",
      "name": "BORRAR ARCHIVO2"
    },
    {
      "parameters": {
        "command": "rm /tmp/mensajeMegadatos.lock"
      },
      "type": "n8n-nodes-base.executeCommand",
      "typeVersion": 1,
      "position": [-6752, 1456],
      "id": "6fbf4351-3aeb-4b7d-941b-6a87e5ad3a16",
      "name": "BORRAR ARCHIVO3"
    },
    {
      "parameters": {
        "query": "=SELECT\n  IPMD.ESTADO,\n  COUNT(1) AS NUM_REGISTROS,\n  IPMD.OBSERVACION\nFROM\n  DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_DET IPMD\n  INNER JOIN DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_CAB IPMC\n    ON IPMC.ID_PROCESO_MASIVO_CAB = IPMD.PROCESO_MASIVO_CAB_ID\nWHERE\n  IPMD.FE_CREACION BETWEEN TO_TIMESTAMP('{{ $('SETEAR FECHAS3').item.json.fecha_inicio }}', 'DD/MM/YYYY HH24:MI:SS.FF')\n    AND TO_TIMESTAMP('{{ $('SETEAR FECHAS3').item.json.fecha_fin }}', 'DD/MM/YYYY HH24:MI:SS.FF')\n  AND IPMC.TIPO_PROCESO = 'CortarCliente'\n  AND IPMC.EMPRESA_ID = 33\n  AND IPMD.ESTADO = 'Fallo'\nGROUP BY\n  IPMD.ESTADO,\n  IPMD.OBSERVACION"
      },
      "type": "n8n-nodes-oracle-database-parameterization.Oracle Database with Parameterization",
      "typeVersion": 1,
      "position": [-3168, 560],
      "id": "ef993225-06e9-4fff-a299-7a80f3b4061a",
      "name": "Oracle Database9",
      "credentials": {
        "oracleCredentials": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "jsCode": "return [{\n  json: {\n    cantidad_rows: items[0].json.rows.length\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-2944, 560],
      "id": "d75c728c-6a33-4cf2-91d0-b633ceea866f",
      "name": "CANTIDAD DE FILAS3"
    },
    {
      "parameters": {
        "jsCode": "// Esta funciÃ³n escapa caracteres especiales para Markdown V2 de Telegram\nconst escape = (t) => String(t ?? '').replace(/([_*\\[\\]()~`>#+\\-=|{}.!])/g, '\\\\$1');\n\nconst rows = $('Oracle Database9').item.json.rows; \n\nlet mensaje = 'ðŸš¨\\n*FALLOS\\\\_CORTES*\\n\\n';\n\nrows.forEach((fila, i) => {\n  mensaje +=\n    `*ESTADO*: \\`${escape(fila.ESTADO)}\\`\\n` +\n    `*NUM\\\\_REGISTROS*: \\`${escape(fila.NUM_REGISTROS)}\\`\\n` +\n    `*OBSERVACION*: \\`${escape(fila.OBSERVACION)}\\`\\n` +\n    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n';\n});\n\nreturn [{json: {mensaje}}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-2720, 560],
      "id": "b68995c4-e08c-44c9-904b-8c0305d1baf1",
      "name": "JUNTAR MENSAJES3"
    },
    {
      "parameters": {
        "query": "=SELECT IPMD.ESTADO,\n       COUNT(1) AS NUM_REGISTROS\nFROM   DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_DET IPMD\n       INNER JOIN DB_INFRAESTRUCTURA.INFO_PROCESO_MASIVO_CAB IPMC\n           ON IPMC.ID_PROCESO_MASIVO_CAB = IPMD.PROCESO_MASIVO_CAB_ID\nWHERE  IPMD.FE_CREACION BETWEEN TO_TIMESTAMP('{{ $('SETEAR FECHAS3').item.json.fecha_inicio }}', 'DD/MM/RRRR HH24:MI:SS.FF')\n                            AND TO_TIMESTAMP('{{ $('SETEAR FECHAS3').item.json.fecha_fin }}', 'DD/MM/RRRR HH24:MI:SS.FF')\n       AND IPMC.TIPO_PROCESO = 'CortarCliente'\n       AND IPMC.EMPRESA_ID = 33\nGROUP BY IPMD.ESTADO"
      },
      "type": "n8n-nodes-oracle-database-parameterization.Oracle Database with Parameterization",
      "typeVersion": 1,
      "position": [-2496, 560],
      "id": "6e7fbe9f-fbf3-4cd6-a2dc-1f17275c4f05",
      "name": "CANTIDAD DE FALLOS3",
      "credentials": {
        "oracleCredentials": {
          "id": "",
          "name": ""
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// FunciÃ³n para escapar caracteres reservados en MarkdownV2\nconst escape = (text) => {\n  return String(text ?? '')\n    .replace(/\\\\/g, '\\\\\\\\')\n    .replace(/([_*\\[\\]()~`>#+=|{}.!-])/g, '\\\\$1');\n};\n\n// Obtener los datos del nodo anterior\nconst rows = $('CANTIDAD DE FALLOS3').item.json.rows;\n\n// Obtener fecha actual en formato YYYY-MM-DD escapado para MarkdownV2\nconst fecha = escape(new Date().toISOString().split('T')[0]); // ej: 2025-09-09\n\n// Construir mensaje principal\nlet mensaje = `*ðŸ“… Fecha:* \\`${fecha}\\`\\n*INFORMACIÃ“N FINAL MASIVOS CORTES ECUANET*\\n\\n`;\n\nrows.forEach(row => {\n  mensaje += \n    `*Estado*: \\`${escape(row.ESTADO)}\\`\\n` +\n    `*NÃºmero de Registros*: \\`${escape(row.NUM_REGISTROS)}\\`\\n` +\n    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n';\n});\n\nreturn [{ json: { mensaje } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-2272, 560],
      "id": "43ad4efd-113f-4d2b-9786-8aa33b36b4ae",
      "name": "UNIR MENSAJES INFO3"
    },
    {
      "parameters": {
        "chatId": "",
        "text": "={{ $('UNIR MENSAJES INFO2').item.json.mensaje }}",
        "additionalFields": {
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [-2048, 944],
      "id": "cdcefc6a-648e-416d-9920-f7a3d2798441",
      "name": "Send a text message10",
      "webhookId": "",
      "credentials": {
        "telegramApi": {
          "id": "",
          "name": " "
        }
      }
    },
    {
      "parameters": {
        "chatId": "",
        "text": "={{ $('UNIR MENSAJES INFO3').item.json.mensaje }}",
        "additionalFields": {
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [-2048, 560],
      "id": "9d445ba1-02cd-489f-8115-55ba1a656250",
      "name": "Send a text message11",
      "webhookId": "",
      "credentials": {
        "telegramApi": {
          "id": "",
          "name": " "
        }
      }
    },
    {
      "parameters": {
        "chatId": "",
        "text": "={{ $('JUNTAR MENSAJES3').item.json.mensaje }}",
        "additionalFields": {
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [-1824, 560],
      "id": "1b85e0ee-db27-4878-b269-2e7b2330e69c",
      "name": "Send a text message12",
      "webhookId": "",
      "credentials": {
        "telegramApi": {
          "id": "",
          "name": " "
        }
      }
    },
    {
      "parameters": {
        "chatId": "",
        "text": "={{ $('JUNTAR MENSAJES2').item.json.mensaje }}",
        "additionalFields": {
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [-1824, 944],
      "id": "a53e95db-855a-436d-9375-6d4dd9dcf524",
      "name": "Send a text message13",
      "webhookId": "",
      "credentials": {
        "telegramApi": {
          "id": "",
          "name": " "
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "1",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "5f171239-0696-4126-a010-e467d6b503b8"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "FLUJO CORTES"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1862140b-d6d3-4bdf-873b-c76a39d045ce",
                    "leftValue": "1",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "MENSAJE ECUANET"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "4de73ebb-013d-4bff-8c6b-5d8149c2a4e5",
                    "leftValue": "1",
                    "rightValue": "1",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "MENSAJE MEGADATOS"
            }
          ]
        },
        "options": {
          "allMatchingOutputs": true
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [-5184, 736],
      "id": "8cce0364-7aca-4aaf-9574-b6d9285a1899",
      "name": "Switch2"
    }
  ],
  "pinData": {},
  "connections": {
    "Oracle Database": {
      "main": [
        [
          {
            "node": "CANTIDAD DE FILAS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message1": {
      "main": [
        [
          {
            "node": "Send a text message2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SETEAR FECHAS": {
      "main": [
        [
          {
            "node": "Oracle Database",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CANTIDAD DE FILAS": {
      "main": [
        [
          {
            "node": "JUNTAR MENSAJES",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JUNTAR MENSAJES": {
      "main": [
        [
          {
            "node": "CANTIDAD DE FALLOS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CANTIDAD DE FALLOS": {
      "main": [
        [
          {
            "node": "UNIR MENSAJES INFO",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "SETEAR FECHAS",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "SETEAR FECHAS1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Oracle Database1": {
      "main": [
        [
          {
            "node": "CANTIDAD DE FILAS1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message": {
      "main": [
        [
          {
            "node": "Send a text message3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CANTIDAD DE FILAS1": {
      "main": [
        [
          {
            "node": "JUNTAR MENSAJES1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JUNTAR MENSAJES1": {
      "main": [
        [
          {
            "node": "CANTIDAD DE FALLOS1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CANTIDAD DE FALLOS1": {
      "main": [
        [
          {
            "node": "UNIR MENSAJES INFO1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SETEAR FECHAS1": {
      "main": [
        [
          {
            "node": "Oracle Database1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BANDERA PENDIENTE Y FALLOS": {
      "main": [
        [
          {
            "node": "CONDICIONAL PENDIENTES",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BANDERA PENDIENTE Y FALLOS1": {
      "main": [
        [
          {
            "node": "CONDICIONAL PENDIENTES1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CONDICIONAL FALLOS": {
      "main": [
        [
          {
            "node": "Send a text message1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a text message6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CONDICIONAL FALLOS1": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a text message7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CONDICIONAL PENDIENTES": {
      "main": [
        [
          {
            "node": "CONDICIONAL FALLOS",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CONDICIONAL PENDIENTES1": {
      "main": [
        [
          {
            "node": "CONDICIONAL FALLOS1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Oracle Database2": {
      "main": [
        [
          {
            "node": "BANDERA EMPRESA 18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CONDICIONAL FALLOS2": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SETEAR FECHAS2": {
      "main": [
        [
          {
            "node": "Oracle Database2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "CONDICIONAL FALLOS2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UNIR MENSAJES INFO": {
      "main": [
        [
          {
            "node": "Send a text message4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message4": {
      "main": [
        [
          {
            "node": "BANDERA PENDIENTE Y FALLOS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UNIR MENSAJES INFO1": {
      "main": [
        [
          {
            "node": "Send a text message5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message5": {
      "main": [
        [
          {
            "node": "BANDERA PENDIENTE Y FALLOS1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "CONDICIONAL FALLOS3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CONDICIONAL FALLOS3": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SET HORA ACTUAL": {
      "main": [
        [
          {
            "node": "IF ENTRE 0 Y 6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF ENTRE 0 Y 6": {
      "main": [
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "SETEAR FECHAS3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Oracle Database3": {
      "main": [
        [
          {
            "node": "BANDERA EMPRESA 33",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BANDERA EMPRESA 18": {
      "main": [
        [
          {
            "node": "Oracle Database3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BANDERA EMPRESA 33": {
      "main": [
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Oracle Database4": {
      "main": [
        [
          {
            "node": "Oracle Database5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Oracle Database5": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SETEAR FECHAS3": {
      "main": [
        [
          {
            "node": "Oracle Database4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "ENCENDER BUS",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "SET HORA ACTUAL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ENCENDER BUS": {
      "main": [
        [
          {
            "node": "ENCENDER BUS RESUMEN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ENCENDER BUS RESUMEN": {
      "main": [
        [
          {
            "node": "ENCENDER REACTIVACIONES",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ENCENDER REACTIVACIONES": {
      "main": [
        [
          {
            "node": "ENCENDER REACTIVACIONES RESUMEN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SET HORA ACTUAL1": {
      "main": [
        [
          {
            "node": "Oracle Database6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SET HORA ACTUAL2": {
      "main": [
        [
          {
            "node": "Oracle Database7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Oracle Database6": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "leer",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "BORRAR ARCHIVO",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "leer": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Code3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code3": {
      "main": [
        [
          {
            "node": "ESCRIBIR",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ESCRIBIR": {
      "main": [
        [
          {
            "node": "Send a text message8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "leer1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "BORRAR ARCHIVO1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "leer1": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ESCRIBIR1": {
      "main": [
        [
          {
            "node": "Send a text message9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "Code4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code4": {
      "main": [
        [
          {
            "node": "ESCRIBIR1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Oracle Database7": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message8": {
      "main": [
        [
          {
            "node": "Oracle Database9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Oracle Database8": {
      "main": [
        [
          {
            "node": "CANTIDAD DE FILAS2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CANTIDAD DE FILAS2": {
      "main": [
        [
          {
            "node": "JUNTAR MENSAJES2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JUNTAR MENSAJES2": {
      "main": [
        [
          {
            "node": "CANTIDAD DE FALLOS2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CANTIDAD DE FALLOS2": {
      "main": [
        [
          {
            "node": "UNIR MENSAJES INFO2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message9": {
      "main": [
        [
          {
            "node": "Oracle Database8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BORRAR ARCHIVO2": {
      "main": [
        [
          {
            "node": "BORRAR ARCHIVO3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Oracle Database9": {
      "main": [
        [
          {
            "node": "CANTIDAD DE FILAS3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CANTIDAD DE FILAS3": {
      "main": [
        [
          {
            "node": "JUNTAR MENSAJES3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JUNTAR MENSAJES3": {
      "main": [
        [
          {
            "node": "CANTIDAD DE FALLOS3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CANTIDAD DE FALLOS3": {
      "main": [
        [
          {
            "node": "UNIR MENSAJES INFO3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UNIR MENSAJES INFO2": {
      "main": [
        [
          {
            "node": "Send a text message10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UNIR MENSAJES INFO3": {
      "main": [
        [
          {
            "node": "Send a text message11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message10": {
      "main": [
        [
          {
            "node": "Send a text message13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message11": {
      "main": [
        [
          {
            "node": "Send a text message12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "SETEAR FECHAS2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "SET HORA ACTUAL1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "SET HORA ACTUAL2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "bb5c06b3-9c87-4618-bc5f-9dc9c0b952d7",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": ""
  },
  "id": "4KZuvvtqzbgKLpHC",
  "tags": []
}
